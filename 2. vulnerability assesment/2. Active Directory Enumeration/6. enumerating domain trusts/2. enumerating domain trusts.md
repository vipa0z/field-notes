## attacking domain trusts
Domain trusts are often set up incorrectly and can provide us with critical unintended attack paths. Also, trusts set up for ease of use may not be reviewed later for potential security implications if security is not considered before establishing the trust relationship. A Merger & Acquisition (M&A) between two companies can result in bidirectional trusts with acquired companies, which can unknowingly introduce risk into the acquiring companyâ€™s environment if the security posture of the acquired company is unknown and untested. 
## Authentication between domains Note

- If bidirectional trust is not enabled,  we cant authenticate between domains
users can authenticate back and forth across both trusts. This is important to note down during an assessment. If we cannot authenticate across a trust, we cannot perform any enumeration or attacks across the trust.

## Scenario abuse of trusts
imagine you can kerberoast the second domain to obtain admin credentials for second domain, if trust is enabled and misconfigured you're literally domain admin in the principal domain/parent domain.
## Domain Trusts inside a forest

![[Pasted image 20250727231028.png]]
## enumerate trusts via bloodhound
![[Pasted image 20250930210806.png]]
Visualizing Trust Relationships in BloodHound
### mapping domains as Forest root or tree root (in this case forest root domain is inlanefreight)
![[Pasted image 20250930211437.png]]
freightlogististc is a different forest, the trust relation is forest
### Viewing trust type

![[Pasted image 20250930211355.png]]


---
## via powershell
## Requires AD Module. (its installed by default on DCs)

## Enumerating Trust Relationships
```powershell-session
Import-Module activedirectory
PS C:\htb> Get-ADTrust -Filter *
```
Checking for Existing Trusts using Get-DomainTrust
```powershell-session
 Get-DomainTrust 

SourceName      : INLANEFREIGHT.LOCAL
TargetName      : LOGISTICS.INLANEFREIGHT.LOCAL
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : WITHIN_FOREST
TrustDirection  : Bidirectional
WhenCreated     : 11/1/2021 6:20:22 PM
WhenChanged     : 2/26/2022 11:55:55 PM
```

PowerView can be used to perform a domain trust mapping and provide information such as the type of trust (parent/child, external, forest) and the direction of the trust (one-way or bidirectional). This information is beneficial once a foothold is obtained, and we plan to compromise the environment further.

```powershell-session
 Get-DomainTrustMapping

SourceName      : INLANEFREIGHT.LOCAL
TargetName      : LOGISTICS.INLANEFREIGHT.LOCAL
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : WITHIN_FOREST
TrustDirection  : Bidirectional
WhenCreated     : 11/1/2021 6:20:22 PM
WhenChanged     : 2/26/2022 11:55:55 PM

SourceName      : INLANEFREIGHT.LOCAL
TargetName      : FREIGHTLOGISTICS.LOCAL
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : FOREST_TRANSITIVE
TrustDirection  : Bidirectional
WhenCreated     : 11/1/2021 8:07:09 PM
WhenChanged     : 2/27/2022 12:02:39 AM
```
![[Pasted image 20250930214117.png]]
the `ForestTransitive` property is set to `True`, which means that this is a forest trust or external trust. We can see that both trusts are set up to be bidirectional, meaning that users can authenticate back and forth across both trusts. This is important to note down during an assessment. If we cannot authenticate across a trust, we cannot perform any enumeration or attacks across the trust.
## Powerview | enumerating trusts via Powerview
PowerView can be used to perform a domain trust mapping and provide information such as the type of trust (parent/child, external, forest) and the direction of the trust (one-way or bidirectional). This information is beneficial once a foothold is obtained, and we plan to compromise the environment further.

### get domain trusts mapping using powerview
```powershell-session
Get-DomainTrustMapping
```

![[Pasted image 20250930214822.png]]

---
## Performing enumeration across the trusts
#### Checking Users in the Child Domain using Get-DomainUser
From here, we could begin performing enumeration across the trusts. For example, we could look at all users in the child domain:
`listing all users in the child domain :powerview`
```powershell-session
 Get-DomainUser -Domain LOGISTICS.INLANEFREIGHT.LOCAL | select SamAccountName

samaccountname
--------------
htb-student_adm
Administrator
```

windows native method:
`` Using netdom to query domain controllers``
```
C:\htb> netdom query /domain:inlanefreight.local dc
List of domain controllers with accounts in the domain:

ACADEMY-EA-DC01
The command completed successfully.
```

`#### Using netdom to query workstations and servers`
```cmd
C:\htb> netdom query /domain:inlanefreight.local workstation
List of workstations with accounts in the domain:

ACADEMY-EA-MS01
ACADEMY-EA-MX01      ( Workstation or Server )

SQL01      ( Workstation or Server )
ILF-XRG      ( Workstation or Server )
MAINLON      ( Workstation or Server )
CISERVER      ( Workstation or Server )
INDEX-DEV-LON      ( Workstation or Server )
...SNIP...
```
We can also use BloodHound to visualize these trust relationships by using the `Map Domain Trusts` pre-built query. Here we can easily see that two bidirectional trusts exist.
![[Pasted image 20250727231705.png]]
