1. enumeration/bruteforcing
2. MTM/spoofing attacks

## DNS Scanning
```
dnsRecon ip
```
### DNS ZONE TRANSF LOCALLY
1. edit /etc/hosts with the ip and domain name
 ask the nameserver (ip provided for exam) for any info on domain
 ```shell
 
 # domain name
  dig ip @Ip -x
 # any query
 dig any domain @Ip
 
 # attempt zone transfer
 dig axfr domain @ip
 ```
 
### ns lookup
```
nslookup
 > server 10.10.1.5
  > ls -d company.local
```

---
### dnsrecon tool
can automate many enumeration tasks, including zone transfers and brute-forcing.
general enum (inclluding zone trasnfer)
```
dnsrecon -d <domain_name> -n <name-server-ip>
```

bruteforcing subdomains
```
dnsrecon -d <domain_name> -n <dns_server_ip> -D /path/to/wordlist.txt -t brt
```

---
### **4. Fierce**

`fierce` is another classic tool specifically designed for DNS enumeration within a corporate network. It first attempts a zone transfer and then falls back to brute-forcing if that fails.
basic scan
```
fierce --domain <domain_name> --dns-server <dns_server_ip>
```

fierce bruteforce mode
```
fierce --domain <domain_name> --dns-server <dns_server_ip> --wordlist /path/to/wordlist.txt
```
_Example:_
```
fierce --domain company.local --dns-server 10.10.1.5 --wordlist /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt`
```

### subbrute tool
`echo 'ip' > resolvers.txt`
subrute -s names.txt -r resolvers.txt
-> new subdomain name server
`dig axfr new.ilf.htb @ip`
you try to find subdomains with subtree
u then add the entries to /etc/hosts
u then dig them dig axfr ns1.ilfr.htb
## DNS Zones

- A DNS zone is a portion of the DNS namespace that a specific organization or administrator manages. Since DNS comprises multiple DNS zones, DNS servers utilize DNS zone transfers to copy a portion of their database to another DNS server.
- An attacker could leverage this DNS zone transfer vulnerability to learn more about the target organization's DNS namespace, increasing the attack surface. For exploitation, we can use the `dig` utility with DNS query type `AXFR` option to dump the entire DNS namespaces from a vulnerable DNS server:


```shell-session
$ dig AXFR @ns1.inlanefreight.htb inlanefreight.htb
```

Tools like [Fierce](https://github.com/mschwager/fierce) can also be used to enumerate all DNS servers of the root domain and scan for a DNS zone transfer:

```shell-session
$ fierce --domain zonetransfer.me
```

---
## Domain and subdomain takeovers

`Domain takeover` is registering a non-existent domain name to gain control over another domain. If attackers find an expired domain, they can claim that domain to perform further attacks such as hosting malicious content on a website or sending a phishing email leveraging the claimed domain.
`basically any subdomain is considered as domain` therefore it can be called domain takeover aswell as subdomain takeover

Domain takeover is also possible with Attacks called `subdomain takeover`. A DNS's canonical name (`CNAME`) record is used to map different domains to a parent domain. Many organizations use third-party services like AWS, GitHub, Akamai, Fastly, and other content delivery networks (CDNs) to host their content. In this case, they usually create a subdomain and make it point to those services. For example,
```shell-session
sub.target.com.   60   IN   CNAME   anotherdomain.com
```

The domain name (e.g., `sub.target.com`) uses a CNAME record to another domain (e.g., `anotherdomain.com`). Suppose the `anotherdomain.com` expires and is available for anyone to claim the domain since the `target.com`'s DNS server has the `CNAME` record. In that case, anyone who registers `anotherdomain.com` will have complete control over `sub.target.com` until the DNS record is updated.

#### Subdomain Enumeration Passive

```shell-session
# ./subfinder -d inlanefreight.com -v       
```
#### Subbrute (NOT WORKING)
```
```
**resolvers** — think of them like different public DNS servers (Google, Cloudflare, OpenDNS, etc.).
add hosts entries for the resolvers

```
ip ns.ilfright.htb
```


```shell-session
git clone https://github.com/TheRook/subbrute.git >> /dev/null 2>&1
cd subbrute
echo "ns1.inlanefreight.htb" > ./resolvers.txt
```

now point to the domain name which will be bruteforced against the resolver server (name server)
```
 python3 subbrute.py inlanefreight.htb -s ./names.txt -r ./resolvers.tx
```


```
./subbrute inlanefreight.com -s ./names.txt -r ./resolvers.txt
```

use `/etc/hosts` and add entry for every subdomain u find

-	There must be precisely one `SOA` record and at least one `NS` record

- If the administrator used a subnet for the `allow-transfer` option for testing purposes or as a workaround solution or set it to `any`, everyone would query the entire zone file at the DNS server. In addition, other zones can be queried, which may even show internal IP addresses and hostnames.

SOA records
contains administrative details about the zone. Here's what an SOA record typically includes:
1. Primary nameserver: The authoritative nameserver for the zone.
2. Responsible person: Email address of the domain administrator (with @ replaced by .).
3. example:
```shell-session
dig soa <DN>
;; AUTHORITY SECTION:
inlanefreight.com.      900     IN      SOA     ns-161.awsdns-20.com. awsdns-hostmaster.amazon.com. 1 7200 900 1209600 86400
```


bruteforcing  to find subdomains by querying an NS 
``` title:find-sub-dnsenum
└──╼ [★]$ dnsenum --dnsserver 10.129.247.54 --enum -p 0 -s 0 -o subdomains.txt -f /usr/share/seclists/Discovery/DNS/fierce-hostlist.txt --threads 90 dev.inlanefreight.htb